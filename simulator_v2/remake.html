<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Parafrazuj lekcje z Gemini</title>
  <style>
body {
  font-family: "Segoe UI", Roboto, Arial, sans-serif;
  margin: 40px auto;
  max-width: 800px;
  line-height: 1.6;
  background: #f5f7fa;
  color: #333;
}

h2, h3 {
  color: #2c3e50;
}

label {
  display: block;
  margin-top: 15px;
  font-weight: 600;
  color: #34495e;
}

input, select, textarea, button {
  margin-top: 8px;
  padding: 10px 12px;
  font-size: 15px;
  border: 1px solid #d0d7de;
  border-radius: 8px;
  width: 100%;
  box-sizing: border-box;
  transition: border-color 0.2s, box-shadow 0.2s;
}

input:focus, select:focus, textarea:focus {
  border-color: #4a90e2;
  box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.25);
  outline: none;
}

button {
  background: #4a90e2;
  color: white;
  font-weight: 600;
  cursor: pointer;
  border: none;
  border-radius: 8px;
  transition: background 0.3s, transform 0.1s;
  width: auto;
}

button:hover {
  background: #357ABD;
}

button:active {
  transform: scale(0.97);
}

textarea {
  resize: vertical;
  min-height: 120px;
}

hr {
  border: none;
  border-top: 1px solid #e1e4e8;
  margin: 20px 0;
}

#responseBox {
  background: #fff;
  border: 1px solid #d0d7de;
  padding: 12px;
  border-radius: 8px;
  font-family: Consolas, monospace;
  min-height: 200px;
}

#RODO {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.65);
  z-index: 1000;
  display: flex;
  justify-content: center;
  align-items: center;
}

#RODO .popup {
  background: #fff;
  padding: 30px 40px;
  border-radius: 16px;
  max-width: 520px;
  text-align: center;
  box-shadow: 0 8px 24px rgba(0,0,0,0.2);
  animation: popupFade 0.3s ease;
}

#rodoAcceptBtn {
  margin-top: 20px;
  padding: 12px 24px;
  border: none;
  border-radius: 10px;
  background: #27ae60;
  color: white;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: background 0.3s, transform 0.1s;
}

#rodoAcceptBtn:hover {
  background: #219150;
}

#rodoAcceptBtn:active {
  transform: scale(0.96);
}

@keyframes popupFade {
  from { opacity: 0; transform: translateY(-15px); }
  to   { opacity: 1; transform: translateY(0); }
}

  </style>
</head>
<body>
  <h2>Wy≈õlij PDF do Gemini i wyekstrachuj dane</h2>

  <!-- Token API -->
  <label for="token">Token (API Key):</label>
  <input type="password" id="token" placeholder="Wprowad≈∫ sw√≥j token...">
  <hr>

  <!-- PDF upload -->
  <label for="pdfInput">Wybierz PDF do sparafrazowania:</label>
  <input type="file" id="pdfInput" accept="application/pdf">
  <button id="sendBtn">Wy≈õlij do Gemini</button>
  <hr>

  <!-- Model selection -->
  <label for="model">Wybierz model AI:</label>
  <select id="model">
    <optgroup label="Gemini 2.5">
      <option value="gemini-2.5-pro">Gemini 2.5 Pro {TYLKO NAJCIƒò≈ªSZE ZADANIA}</option>
      <option value="gemini-2.5-flash">Gemini 2.5 Flash {PODSTAWOWE ZADANIA}</option>
      <option value="gemini-2.5-flash-lite">Gemini 2.5 Flash-Lite {CZƒòSTO POWTARZANE ZADANIA}</option>
    </optgroup>
    <optgroup label="Gemini 2.0">
      <option value="gemini-2.0-flash">Gemini 2.0 Flash {PODSTAWOWE ZADANIA}</option>
      <option value="gemini-2.0-flash-lite" selected>Gemini 2.0 Flash-Lite {CZƒòSTO POWTARZANE ZADANIA}</option>
    </optgroup>
  </select>
  <hr>

  <!-- Wyb√≥r szablonowej instrukcji -->
  <label for="prompt">U≈ºyj szablonowej instrukcji:</label>
  <select id="prompt">
    <optgroup label="podstawowe">
      <option data-prompt="Stw√≥rz kr√≥tkie streszczenie tego materia≈Çu.">Streszczenie lekcji</option>
      <option data-prompt="Wygeneruj 5 pyta≈Ñ testowych z tego materia≈Çu.">Pytania testowe</option>
      <option data-prompt="Przepisz ten tekst w≈Çasnymi s≈Çowami.">Parafrazuj</option>
    </optgroup>
  </select>
  <div style="margin-top:10px;">
    <button id="pastePromptsBtn">üìã Wklej szablony ze schowka</button>
    <button id="copyPromptsBtn">üíæ Kopiuj szablony do schowka</button>
    <button id="addPromptBtn">‚ûï Dodaj do biblioteki</button>
    <button id="saveLibraryBtn">üíæ Zapisz bibliotekƒô do pliku</button>
    <input type="file" id="loadLibraryFile" accept="application/json" style="display:none;">
    <button id="loadLibraryBtn">üìÇ Wczytaj bibliotekƒô z pliku</button>
  </div>
  <hr>

  <label for="newGroup">Nazwa grupy propmt√≥w:</label>
  <input type="text" id="newGroup" placeholder="Np. podstawowe instrukcje">

  <label for="newOption">Nazwa promptu:</label>
  <input type="text" id="newOption" placeholder="Np. u≈Ç√≥≈º pytania testowe">
  <!-- Instruction -->
  <label for="instruction">Instrukcja dla AI:</label>
  <textarea id="instruction" rows="5"></textarea>
  <hr>

  <!-- RODO popup -->
  <div id="RODO">
    <div class="popup">
      <h2>‚ö†Ô∏è Wa≈ºna informacja</h2>
      <p>
        To narzƒôdzie dzia≈Ça w Twojej <b>przeglƒÖdarce</b> i wymaga podania 
        <b>Twojego tokena API Gemini</b>.<br><br>
        <b>Uwaga:</b> Token jest przetwarzany lokalnie w przeglƒÖdarce.  
        Upewnij siƒô, ≈ºe korzystasz z tego narzƒôdzia <b>tylko na zaufanym komputerze</b> 
        i w <b>bezpiecznej przeglƒÖdarce</b>, aby nie ryzykowaƒá utraty swojego klucza.
      </p>
      <button id="rodoAcceptBtn">‚úÖ Akceptujƒô</button>
    </div>
  </div>

  <!-- Response -->
  <h3>Odpowied≈∫:</h3>
  <textarea id="responseBox" rows="10"></textarea>

  <script type="module">
    import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

    let apiToken = "";
    let RODO = false;

    const rodoBtn = document.getElementById("rodoAcceptBtn");
    const rodoDiv = document.getElementById("RODO");
    const modelSelect = document.getElementById("model");
    const instructionBox = document.getElementById("instruction");
    const responseBox = document.getElementById("responseBox");
    const promptSelect = document.getElementById("prompt");
    const pasteBtn = document.getElementById("pastePromptsBtn");
    const copyBtn = document.getElementById("copyPromptsBtn");    
    const newGroupInput = document.getElementById("newGroup");
    const newOptionInput = document.getElementById("newOption");
    const newTextInput = instructionBox;
    const addPromptBtn = document.getElementById("addPromptBtn");

    const saveLibraryBtn = document.getElementById("saveLibraryBtn");
    const loadLibraryBtn = document.getElementById("loadLibraryBtn");
    const loadLibraryFile = document.getElementById("loadLibraryFile");

    // Akceptacja RODO
    rodoBtn.addEventListener("click", () => {
      RODO = true;
      rodoDiv.style.display = "none";
      console.log("RODO zaakceptowane:", RODO);
    });

    // Obs≈Çuga tokenu
    document.getElementById("token").addEventListener("change", (e) => {
      if (apiToken && !RODO) {
        rodoDiv.style.display = "block";
      }
      apiToken = e.target.value.trim();
      console.log("Token ustawiony:", apiToken ? "‚úÖ" : "‚ùå brak");
    });

    // Konwersja PDF ‚Üí base64
    async function fileToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result.split(',')[1]);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    // Wysy≈Çanie PDF do Gemini
    document.getElementById("sendBtn").addEventListener("click", async () => {
      if (!apiToken) {
        alert("Podaj najpierw token API!");
        return;
      }

      const fileInput = document.getElementById("pdfInput");
      if (!fileInput.files.length) {
        alert("Wybierz plik PDF!");
        return;
      }

      const file = fileInput.files[0];
      const base64Data = await fileToBase64(file);

      try {
        const genAI = new GoogleGenerativeAI(apiToken);
        const model = genAI.getGenerativeModel({ 
          model: modelSelect.value 
        });

        const result = await model.generateContent([
          { text: instructionBox.value },
          {
            inlineData: {
              mimeType: file.type,
              data: base64Data
            }
          }
        ]);

        responseBox.value = result.response.text();
      } catch (err) {
        responseBox.value = "B≈ÇƒÖd: " + err.message;
      }
    });

    // Ustawianie instrukcji z wybranego promptu
    promptSelect.addEventListener("change", () => {
      const selectedOption = promptSelect.options[promptSelect.selectedIndex];
      if (selectedOption && selectedOption.dataset.prompt) {
        instructionBox.value = selectedOption.dataset.prompt;
      }
    });

    // Funkcja do wklejania szablon√≥w ze schowka
    async function pastePromptsFromClipboard() {
      try {
        const text = await navigator.clipboard.readText();
        const prompts = JSON.parse(text); // oczekujemy tablicy obiekt√≥w
        buildPromptSelect(prompts);
        alert("‚úÖ Szablony wklejone ze schowka!");
      } catch (err) {
        alert("‚ùå B≈ÇƒÖd przy wklejaniu szablon√≥w: " + err.message);
      }
    }

    // Funkcja do kopiowania szablon√≥w do schowka
    async function copyPromptsToClipboard() {
      try {
        const prompts = extractPromptsFromSelect();
        await navigator.clipboard.writeText(JSON.stringify(prompts, null, 2));
        alert("‚úÖ Szablony skopiowane do schowka!");
      } catch (err) {
        alert("‚ùå B≈ÇƒÖd przy kopiowaniu szablon√≥w: " + err.message);
      }
    }

    // Tworzenie select z obiekt√≥w
    function buildPromptSelect(prompts) {
      promptSelect.innerHTML = ""; // czy≈õcimy stare
      const groups = {};

      // grupowanie po optiongroup
      prompts.forEach(p => {
        if (!groups[p.optiongroup]) {
          const optGroup = document.createElement("optgroup");
          optGroup.label = p.optiongroup || "Inne";
          promptSelect.appendChild(optGroup);
          groups[p.optiongroup] = optGroup;
        }
        const opt = document.createElement("option");
        opt.textContent = p.option;
        opt.dataset.prompt = p.text;
        groups[p.optiongroup].appendChild(opt);
      });
    }

    // Eksportowanie selecta do JSON
    function extractPromptsFromSelect() {
      const prompts = [];
      promptSelect.querySelectorAll("optgroup").forEach(group => {
        group.querySelectorAll("option").forEach(opt => {
          prompts.push({
            optiongroup: group.label,
            option: opt.textContent,
            text: opt.dataset.prompt
          });
        });
      });
      return prompts;
    }

    // Podpinamy przyciski
    pasteBtn.addEventListener("click", pastePromptsFromClipboard);
    copyBtn.addEventListener("click", copyPromptsToClipboard);    


    // obs≈Çuga biblioteki prompt√≥w

    // ‚ûï Dodawanie nowego promptu
    addPromptBtn.addEventListener("click", () => {
      const group = newGroupInput.value.trim() || "Inne";
      const option = newOptionInput.value.trim() || "Nowy prompt";
      const text = newTextInput.value.trim();

      if (!text) {
        alert("‚ùå Wpisz tre≈õƒá instrukcji (text).");
        return;
      }

      // znajd≈∫ grupƒô lub stw√≥rz nowƒÖ
      let optGroup = [...promptSelect.querySelectorAll("optgroup")]
                      .find(g => g.label === group);
      if (!optGroup) {
        optGroup = document.createElement("optgroup");
        optGroup.label = group;
        promptSelect.appendChild(optGroup);
      }

      // dodaj opcjƒô
      const opt = document.createElement("option");
      opt.textContent = option;
      opt.dataset.prompt = text;
      optGroup.appendChild(opt);

      // wyczy≈õƒá pola
      newOptionInput.value = "";
      newTextInput.value = "";

      alert(`‚úÖ Dodano nowy prompt do grupy "${group}".`);
    });

    // üíæ Zapis biblioteki do pliku JSON
    saveLibraryBtn.addEventListener("click", async () => {
      try {
        const prompts = extractPromptsFromSelect();
        const jsonStr = JSON.stringify(prompts, null, 2);

        // otw√≥rz dialog wyboru pliku
        const handle = await window.showSaveFilePicker({
          suggestedName: "biblioteka_promptow.json",
          types: [{
            description: "JSON",
            accept: { "application/json": [".json"] }
          }]
        });

        // utw√≥rz WritableStream i zapisz dane
        const writable = await handle.createWritable();
        await writable.write(jsonStr);
        await writable.close();

        alert("‚úÖ Biblioteka zapisana w wybranym folderze!");
      } catch (err) {
        console.error(err);
        alert("‚ùå B≈ÇƒÖd przy zapisie: " + err.message);
      }
    });


    // üìÇ Wczytywanie biblioteki z pliku JSON
    loadLibraryBtn.addEventListener("click", () => {
      loadLibraryFile.click();
    });

    loadLibraryFile.addEventListener("change", async (event) => {
      const file = event.target.files[0];
      if (!file) return;

      try {
        const text = await file.text();
        const prompts = JSON.parse(text);
        buildPromptSelect(prompts);
        alert("‚úÖ Biblioteka wczytana z pliku.");
      } catch (err) {
        alert("‚ùå B≈ÇƒÖd przy wczytywaniu: " + err.message);
      }
    });
  </script>
</body>
</html>
