<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editable Textarea and Div</title>
    <style>
        :root {
            --viewport-height: 100vh; /* Fallback value */
        }

        /* General reset and basic styling */
        #viewport {
            margin: 0;
            padding: 0;
            display: flex;
            height: var(--viewport-height);
            width: 100vw;
            font-family: Arial, sans-serif;
        }

        /* Default styling for horizontal orientation */
        .scrollable-div, textarea {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            color: black;
            font-size: 1.5rem;
            overflow: auto; /* Enables scrolling */
            box-sizing: border-box; /* Ensures padding is included in width and height */
        }

        .scrollable-div {
            background-color: #9ae69c;
        }

        textarea {
            background-color: #9dcef7;
        }

        /* Vertical orientation styling */
        @media (orientation: portrait) {
            #viewport {
                flex-direction: column;
            }

            .scrollable-div, textarea {
                height: 50%;
                width: 100%;
            }
        }

        /* Horizontal orientation styling */
        @media (orientation: landscape) {
            #viewport {
                flex-direction: row;
            }

            .scrollable-div, textarea {
                width: 50%;
                height: 100%;
            }
        }

        /* Ensure scrollable content stays inside */
        .scrollable-div {
            overflow: auto; /* Adds scrolling to div */
            display: block; /* Avoid elements getting pushed out */
        }

        .editable {
            border: 0.05em solid gray;
            margin-bottom: 0.2em;
            margin-left: 0.2em;
            margin-right: 0.2em;
        }

        .editable:hover{
            background-color: #e9b8e6;
        }

        ol, ul {
            cursor: pointer;
            white-space: pre-wrap; /* Preserve spaces and newlines */
            margin: 0; /* Avoid extra spacing */
            padding: 0; /* Avoid extra spacing */
            overflow-wrap: break-word; /* Ensures compatibility across browsers */
            line-height: 1.0;
        }

        /* Styling for headings */
        h1, h2, h3 {
            cursor: pointer;
            white-space: pre-wrap; /* Preserve spaces and newlines */
            line-height: 1.0;
            margin: 0; /* Avoid extra spacing */
            padding: 0; /* Avoid extra spacing */
        }

        /* Styling for paragraphs */
        p {
            cursor: pointer;
            white-space: pre-wrap; /* Preserve spaces and newlines */
            line-height: 1.0;
            margin: 0; /* Avoid extra spacing */
            padding: 0; /* Avoid extra spacing */
        }

        /* Preformatted text */
        pre {
            white-space: pre-wrap; /* Enables word wrapping */
            word-wrap: break-word; /* Breaks long words if necessary */
            overflow-wrap: break-word; /* Ensures compatibility across browsers */
            margin: 0; /* Prevents extra spacing */
            padding: 0; /* Prevents extra spacing */
            overflow: auto; /* Allows scrolling within pre tags */
            line-height: 1.0;
            background-color: #e9b8e6;
        }

    </style>
</head>
<body>
    <div id="viewport">
        <div class="scrollable-div" id="container">
            <h1>Orientacja</h1>
            <div class="editable">
                <h2>auto psychiczna</h2>
                <p>ImiÄ™ i Nazwisko</p>
                <p>Wiek</p>
                <p>Data Urodzenia</p>
                <hr><pre></pre>
            </div>
            <div class="editable">
                <h2>allo psychiczna</h2>
                <p>Adres Zamieszkania</p>
                <p>Stan Cywilny</p>
                <p>Aktualna Data</p>
                <p>Miejsce Przebywania</p>
                <hr><pre></pre>
            </div>
            <hr>
        </div>

        <textarea id="editor"></textarea>
    </div>

    <button id="saveButton">Zapisz formularz jako html</button>
    <label for="fileInput">Wczytaj formularz</label>
    <input type="file" id="fileInput" accept=".html">

    <script>
        const textarea = document.getElementById('editor');
        const container = document.getElementById('container');
        const saveButton = document.getElementById('saveButton');
        const fileInput = document.getElementById('fileInput');

        let selectedElement = null;
        let selectedGroup = null;

        container.addEventListener('click', (event) => {
            let target = event.target;

            while (target && target !== container) {
                if (target.classList.contains('editable') && target.querySelector('pre')) {
                    if (selectedGroup) {
                        selectedGroup.style.backgroundColor = "#9ae69c";
                    }
                    selectedGroup = target;
                    selectedGroup.style.backgroundColor = "#f3d8f1";
                    selectedElement = target.querySelector('pre');
                    textarea.value = selectedElement.textContent;
                    return;
                }
                target = target.parentElement;
            }
        });



        textarea.addEventListener('input', () => {
            if (selectedElement) {
                selectedElement.textContent = textarea.value;
            }
        });

        saveButton.addEventListener('click', () => {
            const htmlContent = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saved Website</title>
    <style>${document.querySelector('style').textContent}</style>
</head>
<body>
    <div class="scrollable-div" id="container">${container.innerHTML}</div>
</body>
</html>`;


            let name = prompt("Give file name to save as:");
            if (name){
                if (name !== "") {
                    name += '.'
                }
                const blob = new Blob([htmlContent], { type: 'text/html' });
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = `${name}form.html`;
                a.click();
            }
        });

        fileInput.addEventListener('change', (event) => {
            const file = event.target.files[0];

            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = e.target.result;
                    const loadedContainer = tempDiv.querySelector('#container');

                    if (loadedContainer) {
                        container.innerHTML = loadedContainer.innerHTML;
                    } else {
                        alert('No valid container found in the loaded file.');
                    }
                };
                reader.readAsText(file);
            }
        });

        let previousScroll = container.scrollTop;

        textarea.addEventListener('focus', () => {
            // Save the current scroll position of the container
            const previousScroll = container.scrollTop;

            // Update the viewport height and restore the scroll position after a delay
            setTimeout(() => {
                updateViewportHeight(); // Recalculate the viewport height
                container.scrollTop = previousScroll; // Restore the container's scroll position
                window.scrollTo(0, 0); // Ensure the body is scrolled to the top
            }, 300); // Adjust delay based on keyboard animation duration
        });


        textarea.addEventListener('blur', () => {
        // Update the saved scroll position on blur
        previousScroll = container.scrollTop;
        });    

        function updateViewportHeight() {
            const vh = window.innerHeight; // 1% of the viewport height
            document.documentElement.style.setProperty('--viewport-height', `${vh}px`);
        }

        // Update on load and resize
        window.addEventListener('load', updateViewportHeight);
        window.addEventListener('resize', updateViewportHeight);        
    </script>
</body>
</html>
