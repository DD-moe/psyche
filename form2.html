<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editable Textarea and Div</title>
    <style>

        /* General reset and basic styling */
        #viewport {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100%;
            font-family: Arial, sans-serif;
        }

        /* Default styling for horizontal orientation */
        .scrollable-div, textarea {
            display: block;
            box-sizing: border-box; /* Ensures padding is included in width and height */
            justify-content: center;
            align-items: center;
            color: black;
            font-size: 1.5rem;
            overflow: auto; /* Enables scrolling */
            scrollbar-width: thin;
        }

        .scrollable-div {
            background-color: #9ae69c;
        }

        textarea {
            background-color: #9dcef7;
        }

        /* Vertical orientation styling */
        @media (orientation: portrait) {
            #viewport {
                flex-direction: column;
            }

            .scrollable-div {
                height: 60%;
                width: 99%;
            }
            textarea {
                height: 40%;
                width: 99%;
            }
        }

        /* Horizontal orientation styling */
        @media (orientation: landscape) {
            #viewport {
                flex-direction: row;
            }

            .scrollable-div, textarea {
                width: 50%;
                height: 99%;
            }
        }

        .editable {
            border: 0.05em solid gray;
            margin-bottom: 0.2em;
            margin-left: 0.2em;
            margin-right: 0.2em;
        }

        .editable:hover{
            background-color: #e9b8e6;
        }

        ol, ul {
            cursor: pointer;
            white-space: pre-wrap; /* Preserve spaces and newlines */
            margin: 0; /* Avoid extra spacing */
            padding: 0; /* Avoid extra spacing */
            overflow-wrap: break-word; /* Ensures compatibility across browsers */
            line-height: 1.0;
        }

        /* Styling for headings */
        h1, h2, h3 {
            cursor: pointer;
            white-space: pre-wrap; /* Preserve spaces and newlines */
            line-height: 1.0;
            margin: 0; /* Avoid extra spacing */
            padding: 0; /* Avoid extra spacing */
        }

        /* Styling for paragraphs */
        p {
            cursor: pointer;
            white-space: pre-wrap; /* Preserve spaces and newlines */
            line-height: 1.0;
            margin: 0; /* Avoid extra spacing */
            padding: 0; /* Avoid extra spacing */
        }

        /* Preformatted text */
        pre {
            white-space: pre-wrap; /* Enables word wrapping */
            word-wrap: break-word; /* Breaks long words if necessary */
            overflow-wrap: break-word; /* Ensures compatibility across browsers */
            margin: 0; /* Prevents extra spacing */
            padding: 0; /* Prevents extra spacing */
            overflow: auto; /* Allows scrolling within pre tags */
            line-height: 1.0;
            background-color: #e9b8e6;
            scrollbar-width: thin;
        }

        /* Hide button, file input, and textarea in printing mode */
        @media print {
            #saveButton,
            #fileInput,
            textarea {
                display: none; /* Hide these elements */
            }
            .scrollable-div {
                height: 100%;
                width: 99%;
                background-color: white;
            }
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: pointer;
            margin: 0;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 80%;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 5px;
            white-space: pre-wrap; /* Preserve spaces and newlines */
            line-height: 1.0;
            margin: 0; /* Avoid extra spacing */
            padding: 0; /* Avoid extra spacing */
            position: fixed;
            z-index: 1;
            left: 10%;
            margin: 0;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }        

        #steering {
            display: flex; /* Enables Flexbox */
            flex-direction: row; /* Default direction: items align horizontally */
            justify-content: space-around; /* Distribute items with equal space between them */
            align-items: center; /* Align items vertically to the center */
            gap: 1rem; /* Adds spacing between items */
            padding: 1rem; /* Inner spacing */
            background-color: #f0f0f0; /* Light gray background */
            border-radius: 8px; /* Rounded corners */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Subtle shadow for depth */
            width: 100%;
            flex-wrap: wrap; /* Allow items to wrap */
            flex: 1;
            box-sizing: border-box; /* Ensures padding is included in width and height */
            }

            #steering > * {
            text-align: center; /* Centers text inside each child */
            padding: 0.5rem; /* Inner spacing for children */
            background-color: #ffffff; /* White background for children */
            border: 1px solid #ddd; /* Light border for separation */
            border-radius: 4px; /* Rounded corners for children */
            transition: transform 0.3s ease, background-color 0.3s ease; /* Smooth animations */
            display: block;
            box-sizing: border-box; /* Ensures padding is included in width and height */
            }

            #steering > *:hover {
            background-color: #e0e0e0; /* Slightly darker background on hover */
            transform: scale(1.05); /* Subtle zoom effect */
        }

    </style>
</head>
<body>
    <div id="viewport">
        <div class="scrollable-div" id="container">
            <h1>Orientacja:</h1>
            <div class="editable">
                <h2>auto psychiczna<span class="tooltip">&#9733;<span class="tooltiptext">Podaj najlepiej pełne dane personalne</span></span></h2>
                <p>Imię i Nazwisko</p>
                <p>Wiek</p>
                <p>Data Urodzenia</p>
                <hr><pre></pre>
            </div>
            <div class="editable">
                <h2>allo psychiczna</h2>
                <p>Adres Zamieszkania</p>
                <p>Stan Cywilny</p>
                <p>Aktualna Data<span class="tooltip">&#9733;<span class="tooltiptext">Lub orientacyjnie, dzień, dzień tygodnia, miesiąc, pora roku</span></span></p>
                <p>Miejsce Przebywania</p>
                <hr><pre></pre>
            </div>
            <hr>
        </div>

        <textarea id="editor"></textarea>
    </div>
    <div id="steering">
        <button id="saveButton">Zapisz formularz jako html</button>
        <div>
            <label for="fileInput">Wczytaj formularz: </label>
            <input type="file" id="fileInput" accept=".html">
        </div>
        <button id="fullscreen">Enter Fullscreen mode</button>
    </div>
    <script>
        const textarea = document.getElementById('editor');
        const container = document.getElementById('container');
        const saveButton = document.getElementById('saveButton');
        const fileInput = document.getElementById('fileInput');

        let selectedElement = null;
        let selectedGroup = null;

        container.addEventListener('click', (event) => {
            let target = event.target;

            while (target && target !== container) {
                if (target.classList.contains('editable') && target.querySelector('pre')) {
                    if (selectedGroup) {
                        selectedGroup.style.backgroundColor = "#9ae69c";
                    }
                    selectedGroup = target;
                    selectedGroup.style.backgroundColor = "#f3d8f1";
                    selectedElement = target.querySelector('pre');
                    textarea.value = selectedElement.textContent;
                    return;
                }
                target = target.parentElement;
            }
        });



        textarea.addEventListener('input', () => {
            if (selectedElement) {
                selectedElement.textContent = textarea.value;
            }
        });

        saveButton.addEventListener('click', () => {
            if (selectedGroup) {
                selectedGroup.style.backgroundColor = "#9ae69c";
            }
            const htmlContent = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saved Website</title>
    <style>${document.querySelector('style').textContent}</style>
</head>
<body>
    <div class="scrollable-div" id="container">${container.innerHTML}</div>
</body>
</html>`;


            let name = prompt("Give file name to save as:");
            if (name){
                if (name !== "") {
                    name += '.'
                }
                const blob = new Blob([htmlContent], { type: 'text/html' });
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = `${name}form.html`;
                a.click();
            }
        });

        fileInput.addEventListener('change', (event) => {
            const file = event.target.files[0];

            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = e.target.result;
                    const loadedContainer = tempDiv.querySelector('#container');

                    if (loadedContainer) {
                        container.innerHTML = loadedContainer.innerHTML;
                    } else {
                        alert('No valid container found in the loaded file.');
                    }
                };
                reader.readAsText(file);
            }
        });


        let previousCoursorFocus = true;

        function handleFocusOrClick() {
            textarea.focus({ preventScroll: true }); // Prevent default scrolling behavior
            container.focus({ preventScroll: true }); // Prevent default scrolling behavior
            if (previousCoursorFocus) {
                container.scrollIntoView({ behavior: 'smooth', block: 'start' }); // Ensure the container is visible
            } else {
                textarea.scrollIntoView({ behavior: 'smooth', block: 'start' }); // Ensure the container is visible
            }
            previousCoursorFocus = !previousCoursorFocus;

        }

        // Attach click event
        container.addEventListener('click', handleFocusOrClick);


        textarea.addEventListener('blur', () => {
        // Update the saved scroll position on blur
        previousScroll = container.scrollTop;
        });    


// fullscreen mode: 
const button_fullscreen = document.getElementById("fullscreen");

document.addEventListener("DOMContentLoaded", () => {
    // Check if the user was in fullscreen mode before and try to re-enter
    if (localStorage.getItem("isFullscreen") === "true") {
      enterFullscreen();
    }
  });

  // Event listener for button click
  button_fullscreen.addEventListener("click", () => {
      if (document.fullscreenElement) {
        exitFullscreen();
      } else {
        enterFullscreen();
      }
    });

    // Enter fullscreen mode
    function enterFullscreen() {
      const element = document.documentElement; // Fullscreen the entire page
      if (element.requestFullscreen) {
        element.requestFullscreen();
      } else if (element.webkitRequestFullscreen) { // Safari
        element.webkitRequestFullscreen();
      } else if (element.msRequestFullscreen) { // IE11
        element.msRequestFullscreen();
      }
      localStorage.setItem("isFullscreen", "true");
      button.textContent = "Exit Fullscreen Mode";
    }

    // Exit fullscreen mode
    function exitFullscreen() {
      if (document.exitFullscreen) {
        document.exitFullscreen();
      } else if (document.webkitExitFullscreen) { // Safari
        document.webkitExitFullscreen();
      } else if (document.msExitFullscreen) { // IE11
        document.msExitFullscreen();
      }
      localStorage.setItem("isFullscreen", "false");
      button.textContent = "Enter Fullscreen Mode";
    }

    // Listen for fullscreen change events
    document.addEventListener("fullscreenchange", updateButtonState);
    document.addEventListener("webkitfullscreenchange", updateButtonState); // Safari
    document.addEventListener("msfullscreenchange", updateButtonState); // IE11

    // Update button state based on fullscreen status
    function updateButtonState() {
      if (document.fullscreenElement) {
        button.textContent = "Exit Fullscreen Mode";
      } else {
        button.textContent = "Enter Fullscreen Mode";
      }
    }

    </script>
</body>
</html>
