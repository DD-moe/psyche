<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Edytor JSON konfiguracji (diagnostyki) pacjenta</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="../g_styles.css">
<link rel="stylesheet" href="tools.css">
<link rel="icon" type="image/png" sizes="192x192" href="..//icons/icon-192.jpg">
<link rel="apple-touch-icon" href="../icons/icon-512.jpg">
</head>
<body>
<h1>Podwójny edytor JSON (w zakładkach)</h1>

<div class="tabs">
  <div class="tab-btn active" data-tab="editor1">Edytor 1 — Zlecenia / Badania</div>
  <div class="tab-btn" data-tab="editor2">Edytor 2 — Historia</div>
</div>

<!-- ======================= EDYTOR 1 ======================= -->
<div id="editor1" class="editor-panel active">
  <h2>Edytor obiektu JSON (czas_min, czas_max, cena, wynik, kategoria)</h2>

  <div class="section">
    <label>Wklej / skopiuj JSON</label>
    <div class="ctrl">
      <button onclick="copyJSON(1)">Kopiuj</button>
      <button onclick="pasteJSON(1)">Wklej</button>
    </div>
    <textarea id="jsonInput1" rows="10"></textarea>
  </div>

  <div class="section">
    <label>Wybierz element (key)</label>
    <select id="keySelect1" onchange="loadKeyData(1)"></select>
  </div>

  <div class="section">
    <label>czas_min</label><input id="czas_min1" />
    <label>czas_max</label><input id="czas_max1" />
    <label>cena</label><input id="cena1" type="number" step="0.01" />
    <label>wynik</label><textarea id="wynik1" rows="2"></textarea>
    <label>kategoria</label><input id="kategoria1" />
  </div>

  <div class="ctrl">
    <button onclick="saveKey(1)">Zapisz zmiany</button>
    <button onclick="deleteKey(1)">Usuń wybrany key</button>
    <button onclick="addKey(1)">Dodaj nowy key</button>
  </div>
</div>

<!-- ======================= EDYTOR 2 ======================= -->
<div id="editor2" class="editor-panel">
  <h2>Edytor obiektu JSON (historia)</h2>

  <div class="section">
    <label>Wklej / skopiuj JSON</label>
    <div class="ctrl">
      <button onclick="copyJSON(2)">Kopiuj</button>
      <button onclick="pasteJSON(2)">Wklej</button>
    </div>
    <textarea id="jsonInput2" rows="10"></textarea>
  </div>

  <div class="section">
    <label>Wybierz key z historii</label>
    <select id="keySelect2" onchange="loadKeyData(2)"></select>
  </div>

  <div class="section">
    <label>data</label><input id="data2" />
    <label>cena</label><input id="cena2" type="number" step="0.01" />
    <label>wynik</label><textarea id="wynik2" rows="2"></textarea>
  </div>

  <div class="ctrl">
    <button onclick="saveKey(2)">Zapisz zmiany</button>
    <button onclick="deleteKey(2)">Usuń wybrany key</button>
    <button onclick="addKey(2)">Dodaj nowy key</button>
  </div>
</div>

<script>
/************ PRZEŁĄCZANIE ZAKŁADEK ************/
const tabs = document.querySelectorAll('.tab-btn');
const panels = document.querySelectorAll('.editor-panel');
tabs.forEach(btn => {
  btn.onclick = () => {
    tabs.forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    panels.forEach(p => p.classList.remove('active'));
    document.getElementById(btn.dataset.tab).classList.add('active');
  };
});

/************ FUNKCJE WSPÓLNE ************/
function copyJSON(n) {
  const txt = document.getElementById('jsonInput' + n).value;
  navigator.clipboard.writeText(txt);
}
function pasteJSON(n) {
  navigator.clipboard.readText().then(t => {
    document.getElementById('jsonInput' + n).value = t;
    rebuildSelect(n);
  });
}

function rebuildSelect(n) {
  const raw = document.getElementById('jsonInput' + n).value;
  const sel = document.getElementById('keySelect' + n);
  sel.innerHTML = '';
  try {
    const obj = JSON.parse(raw);
    Object.keys(obj).forEach(k => {
      const o = document.createElement('option');
      o.value = k;
      o.textContent = k;
      sel.appendChild(o);
    });
  } catch (e) {}
}

function loadKeyData(n) {
  const raw = document.getElementById('jsonInput' + n).value;
  const sel = document.getElementById('keySelect' + n);
  const key = sel.value;
  try {
    const obj = JSON.parse(raw);
    const item = obj[key];
    if (!item) return;

    if (n === 1) {
      document.getElementById('czas_min1').value = item.czas_min || '';
      document.getElementById('czas_max1').value = item.czas_max || '';
      document.getElementById('cena1').value = item.cena || '';
      document.getElementById('wynik1').value = item.wynik || '';
      document.getElementById('kategoria1').value = item.kategoria || '';
    } else {
      document.getElementById('data2').value = item.data || '';
      document.getElementById('cena2').value = item.cena || '';
      document.getElementById('wynik2').value = item.wynik || '';
    }
  } catch (e) {}
}

function saveKey(n) {
  const raw = document.getElementById('jsonInput' + n).value;
  const sel = document.getElementById('keySelect' + n);
  const key = sel.value;
  try {
    const obj = JSON.parse(raw);
    if (n === 1) {
      obj[key] = {
        czas_min: document.getElementById('czas_min1').value,
        czas_max: document.getElementById('czas_max1').value,
        cena: parseFloat(document.getElementById('cena1').value),
        wynik: document.getElementById('wynik1').value,
        kategoria: document.getElementById('kategoria1').value
      };
    } else {
      obj[key] = {
        data: document.getElementById('data2').value,
        cena: parseFloat(document.getElementById('cena2').value),
        wynik: document.getElementById('wynik2').value
      };
    }
    document.getElementById('jsonInput' + n).value = JSON.stringify(obj, null, 2);
    rebuildSelect(n);
  } catch (e) {}
}

function deleteKey(n) {
  const raw = document.getElementById('jsonInput' + n).value;
  const sel = document.getElementById('keySelect' + n);
  const key = sel.value;
  try {
    const obj = JSON.parse(raw);
    delete obj[key];
    document.getElementById('jsonInput' + n).value = JSON.stringify(obj, null, 2);
    rebuildSelect(n);
  } catch (e) {}
}

function addKey(n) {
  const name = prompt('Podaj nowy key');
  if (!name) return;
  const raw = document.getElementById('jsonInput' + n).value;
  try {
    const obj = JSON.parse(raw);
    obj[name] = n === 1
      ? { czas_min:"", czas_max:"", cena:0, wynik:"", kategoria:"" }
      : { data:"", cena:0, wynik:"" };
    document.getElementById('jsonInput' + n).value = JSON.stringify(obj, null, 2);
    rebuildSelect(n);
  } catch (e) {}
}
</script>
</body>
</html>
